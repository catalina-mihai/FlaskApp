<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Interrelated Dropdowns Example</title>
</head>
<body>
    <form>
        <!-- Asset Class Dropdown -->
        <label for="assetClass">Asset Class:</label>
        <select id="assetClass" name="assetClass" onchange="updateInstrumentType(this.value)">
            <option value="">Choose an Asset Class</option>
            {% for option in all_data.assetClass %}
                <option value="{{ option }}">{{ option }}</option>
            {% endfor %}
        </select>

        <!-- Instrument Type Dropdown -->
        <label for="instrumentType">Instrument Type:</label>
        <select id="instrumentType" name="instrumentType" disabled>
            <option value="">Choose an Instrument Type</option>
        </select>

        <!-- Use Case Dropdown -->
        <label for="useCase">Use Case:</label>
        <select id="useCase" name="useCase" disabled>
            <option value="">Choose a Use Case</option>
        </select>

        <!-- Level Dropdown -->
        <label for="level">Level:</label>
        <select id="level" name="level" disabled>
            <option value="">Choose a Level</option>
        </select>

        <!-- Template Version Dropdown -->
        <label for="templateVersion">Template Version:</label>
        <select id="templateVersion" name="templateVersion" disabled>
            <option value="">Choose a Template Version</option>
        </select>
    </form>

    <script>
        // Get all the data passed from the server side
        const allData = {{ all_data | tojson | safe }};
        console.log('All Data:', allData); // For debugging

        // Update the Instrument Type dropdown based on the selected Asset Class
        function updateInstrumentType(assetClass) {
            let instrumentTypeDropDown = document.querySelector("#instrumentType");
            let useCaseDropDown = document.querySelector("#useCase");
            let levelDropDown = document.querySelector("#level");
            let templateVersionDropDown = document.querySelector("#templateVersion");
            
            // Clear all the dependent dropdowns and disable them
            instrumentTypeDropDown.innerHTML = `<option value="">Choose an Instrument Type</option>`;
            useCaseDropDown.innerHTML = `<option value="">Choose a Use Case</option>`;
            levelDropDown.innerHTML = `<option value="">Choose a Level</option>`;
            templateVersionDropDown.innerHTML = `<option value="">Choose a Template Version</option>`;
            instrumentTypeDropDown.disabled = true;
            useCaseDropDown.disabled = true;
            levelDropDown.disabled = true;
            templateVersionDropDown.disabled = true;

            if (assetClass.trim() === "") {
                return;
            }

            // Fetch filtered data from the server
            fetch('/get_filtered_data', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify({ assetClass: assetClass })
            })
            .then(response => response.json())
            .then(data => {
                console.log('Filtered Data:', data); // For debugging

                // Populate the Instrument Type dropdown
                data.instrumentType.forEach(type => {
                    instrumentTypeDropDown.innerHTML += `<option value="${type}">${type}</option>`;
                });
                instrumentTypeDropDown.disabled = false;

                // Add event listener to update the Use Case dropdown based on selected Instrument Type
                instrumentTypeDropDown.onchange = function() {
                    updateUseCase(instrumentTypeDropDown.value, data);
                };
            })
            .catch(error => console.error('Error:', error));
        }

        // Update the Use Case dropdown based on the selected Instrument Type
        function updateUseCase(instrumentType, filteredData) {
            let useCaseDropDown = document.querySelector("#useCase");
            useCaseDropDown.innerHTML = `<option value="">Choose a Use Case</option>`;
            let useCases = filteredData.useCase;

            useCases.forEach(useCase => {
                useCaseDropDown.innerHTML += `<option value="${useCase}">${useCase}</option>`;
            });
            useCaseDropDown.disabled = false;

            // Add event listener to update the Level dropdown based on selected Use Case
            useCaseDropDown.onchange = function() {
                updateLevel(useCaseDropDown.value, filteredData);
            };
        }

        // Update the Level dropdown based on the selected Use Case
        function updateLevel(useCase, filteredData) {
            let levelDropDown = document.querySelector("#level");
            levelDropDown.innerHTML = `<option value="">Choose a Level</option>`;
            let levels = filteredData.level;

            levels.forEach(level => {
                levelDropDown.innerHTML += `<option value="${level}">${level}</option>`;
            });
            levelDropDown.disabled = false;

            // Add event listener to update the Template Version dropdown based on selected Level
            levelDropDown.onchange = function() {
                updateTemplateVersion(levelDropDown.value, filteredData);
            };
        }

        // Update the Template Version dropdown based on the selected Level
        function updateTemplateVersion(level, filteredData) {
            let templateVersionDropDown = document.querySelector("#templateVersion");
            templateVersionDropDown.innerHTML = `<option value="">Choose a Template Version</option>`;
            let templateVersions = filteredData.templateVersion;

            templateVersions.forEach(templateVersion => {
                templateVersionDropDown.innerHTML += `<option value="${templateVersion}">${templateVersion}</option>`;
            });
            templateVersionDropDown.disabled = false;
        }
    </script>
</body>
</html>
