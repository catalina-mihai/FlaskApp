<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Interrelated Dropdowns Example</title>
</head>
<body>
    <form id="searchForm">
        <label for="assetClass">Asset Class:</label>
        <select id="assetClass" name="assetClass" onchange="updateInstrumentType(this.value)">
            <option value="">Choose an Asset Class</option>
            {% for option in all_data.assetClass %}
                <option value="{{ option }}">{{ option }}</option>
            {% endfor %}
        </select>

        <label for="instrumentType">Instrument Type:</label>
        <select id="instrumentType" name="instrumentType" disabled onchange="updateUseCase(this.value)">
            <option value="">Choose an Instrument Type</option>
        </select>

        <label for="useCase">Use Case:</label>
        <select id="useCase" name="useCase" disabled onchange="updateLevel(this.value)">
            <option value="">Choose a Use Case</option>
        </select>

        <label for="level">Level:</label>
        <select id="level" name="level" disabled onchange="updateTemplateVersion(this.value)">
            <option value="">Choose a Level</option>
        </select>

        <label for="templateVersion">Template Version:</label>
        <select id="templateVersion" name="templateVersion" disabled>
            <option value="">Can be left blank</option>
        </select>

        <button type="button" onclick="performSearch()">Search</button>
    </form>

    <script>
        const allData = {{ all_data | tojson | safe }};
        console.log('All Data:', allData);

        function updateInstrumentType(assetClass) {
            let instrumentTypeDropDown = document.querySelector("#instrumentType");
            let useCaseDropDown = document.querySelector("#useCase");
            let levelDropDown = document.querySelector("#level");
            let templateVersionDropDown = document.querySelector("#templateVersion");

            resetDropdown('instrumentType');
            resetDropdown('useCase');
            resetDropdown('level');
            resetDropdown('templateVersion');

            if (assetClass && allData.instrumentType[assetClass]) {
                allData.instrumentType[assetClass].forEach(type => {
                    instrumentTypeDropDown.innerHTML += `<option value="${type}">${type}</option>`;
                });
                instrumentTypeDropDown.disabled = false;
            }
        }

        function updateUseCase(instrumentType) {
            let useCaseDropDown = document.querySelector("#useCase");
            let assetClass = document.querySelector("#assetClass").value;
            resetDropdown('useCase');
            resetDropdown('level');
            resetDropdown('templateVersion');

            if (assetClass && instrumentType && allData.useCase[assetClass] && allData.useCase[assetClass][instrumentType]) {
                allData.useCase[assetClass][instrumentType].forEach(use => {
                    useCaseDropDown.innerHTML += `<option value="${use}">${use}</option>`;
                });
                useCaseDropDown.disabled = false;
            }
        }

        function updateLevel(useCase) {
            let levelDropDown = document.querySelector("#level");
            let assetClass = document.querySelector("#assetClass").value;
            let instrumentType = document.querySelector("#instrumentType").value;
            resetDropdown('level');
            resetDropdown('templateVersion');

            if (assetClass && instrumentType && useCase && allData.level[assetClass] &&
                allData.level[assetClass][instrumentType] && allData.level[assetClass][instrumentType][useCase]) {
                allData.level[assetClass][instrumentType][useCase].forEach(level => {
                    levelDropDown.innerHTML += `<option value="${level}">${level}</option>`;
                });
                levelDropDown.disabled = false;
            }
        }

        function updateTemplateVersion(level) {
            let templateVersionDropDown = document.querySelector("#templateVersion");
            let assetClass = document.querySelector("#assetClass").value;
            let instrumentType = document.querySelector("#instrumentType").value;
            let useCase = document.querySelector("#useCase").value;
            resetDropdown('templateVersion');

            if (assetClass && instrumentType && useCase && level && 
                allData.templateVersion[assetClass] &&
                allData.templateVersion[assetClass][instrumentType] &&
                allData.templateVersion[assetClass][instrumentType][useCase] &&
                allData.templateVersion[assetClass][instrumentType][useCase][level]) {
                
                allData.templateVersion[assetClass][instrumentType][useCase][level].forEach(version => {
                    templateVersionDropDown.innerHTML += `<option value="${version}">${version}</option>`;
                });
                templateVersionDropDown.disabled = false;
            }
        
            console.log('Selected path:', assetClass, instrumentType, useCase, level);  // For debugging
        }


        // Reset a dropdown to its default state
        function resetDropdown(dropdownId) {
            let dropdown = document.querySelector(`#${dropdownId}`);
            dropdown.innerHTML = `<option value="">Choose a ${dropdownId.charAt(0).toUpperCase() + dropdownId.slice(1)}</option>`;
            dropdown.disabled = true;
        }

        // Function to perform the search (to be implemented)
        function performSearch() {
            // Perform the search based on selected options
            console.log('Performing search with selected values');
        }
    </script>
</body>
</html>
