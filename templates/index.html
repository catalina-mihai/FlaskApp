<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Interrelated Dropdowns Example</title>
</head>
<body>
    <form>
        <!-- Asset Class Dropdown -->
        <label for="assetClass">Asset Class:</label>
        <select id="assetClass" name="assetClass" onchange="updateInstrumentType(this.value)">
            <option value="">Choose an Asset Class</option>
            {% for option in all_data.assetClass %}
                <option value="{{ option }}">{{ option }}</option>
            {% endfor %}
        </select>

        <!-- Instrument Type Dropdown -->
        <label for="instrumentType">Instrument Type:</label>
        <select id="instrumentType" name="instrumentType" disabled>
            <option value="">Choose an Instrument Type</option>
        </select>

        <!-- Use Case Dropdown -->
        <label for="useCase">Use Case:</label>
        <select id="useCase" name="useCase" disabled>
            <option value="">Choose a Use Case</option>
        </select>

        <!-- Level Dropdown -->
        <label for="level">Level:</label>
        <select id="level" name="level" disabled>
            <option value="">Choose a Level</option>
        </select>

        <!-- Template Version Dropdown -->
        <label for="templateVersion">Template Version:</label>
        <select id="templateVersion" name="templateVersion" disabled>
            <option value="">Choose a Template Version</option>
        </select>
    </form>

    <script>
        // Get all the data passed from the server side
        const allData = {{ all_data | tojson | safe }};
        console.log('All Data:', allData);

        // Update the Instrument Type dropdown based on the selected Asset Class
        function updateInstrumentType(assetClass) {
            let instrumentTypeDropDown = document.querySelector("#instrumentType");
            let useCaseDropDown = document.querySelector("#useCase");
            let levelDropDown = document.querySelector("#level");
            let templateVersionDropDown = document.querySelector("#templateVersion");
            
            // Clear all the dependent dropdowns and disable them
            instrumentTypeDropDown.innerHTML = `<option value="">Choose an Instrument Type</option>`;
            useCaseDropDown.innerHTML = `<option value="">Choose a Use Case</option>`;
            levelDropDown.innerHTML = `<option value="">Choose a Level</option>`;
            templateVersionDropDown.innerHTML = `<option value="">Choose a Template Version</option>`;
            instrumentTypeDropDown.disabled = true;
            useCaseDropDown.disabled = true;
            levelDropDown.disabled = true;
            templateVersionDropDown.disabled = true;

            if (assetClass.trim() === "") {
                return;
            }

            // Filter Instrument Types based on Asset Class (if applicable)
            let instrumentTypes = allData.instrumentType; // Assuming this is a flat list
            instrumentTypes.forEach((type) => {
                // Add additional filtering logic here if you have criteria
                instrumentTypeDropDown.innerHTML += `<option value="${type}">${type}</option>`;
            });
            instrumentTypeDropDown.disabled = false;

            // Add event listener to update the Use Case dropdown based on selected Instrument Type
            instrumentTypeDropDown.onchange = function() {
                updateUseCase(instrumentTypeDropDown.value);
            };
        }

        // Update the Use Case dropdown based on the selected Instrument Type
        function updateUseCase(instrumentType) {
            let useCaseDropDown = document.querySelector("#useCase");
            useCaseDropDown.innerHTML = `<option value="">Choose a Use Case</option>`;
            let useCases = allData.useCase; // Assuming this is a flat list
            useCases.forEach((useCase) => {
                useCaseDropDown.innerHTML += `<option value="${useCase}">${useCase}</option>`;
            });
            useCaseDropDown.disabled = false;

            // Add event listener to update the Level dropdown based on selected Use Case
            useCaseDropDown.onchange = function() {
                updateLevel(useCaseDropDown.value);
            };
        }

        // Update the Level dropdown based on the selected Use Case
        function updateLevel(useCase) {
            let levelDropDown = document.querySelector("#level");
            levelDropDown.innerHTML = `<option value="">Choose a Level</option>`;
            let levels = allData.level; // Assuming this is a flat list
            levels.forEach((level) => {
                levelDropDown.innerHTML += `<option value="${level}">${level}</option>`;
            });
            levelDropDown.disabled = false;

            // Add event listener to update the Template Version dropdown based on selected Level
            levelDropDown.onchange = function() {
                updateTemplateVersion(levelDropDown.value);
            };
        }

        // Update the Template Version dropdown based on the selected Level
        function updateTemplateVersion(level) {
            let templateVersionDropDown = document.querySelector("#templateVersion");
            templateVersionDropDown.innerHTML = `<option value="">Choose a Template Version</option>`;
            let templateVersions = allData.templateVersion; // Assuming this is a flat list
            templateVersions.forEach((version) => {
                templateVersionDropDown.innerHTML += `<option value="${version}">${version}</option>`;
            });
            templateVersionDropDown.disabled = false;
        }
    </script>
</body>
</html>
